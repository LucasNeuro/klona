---
// CTA section component - Sem IA
---

<section id="contato" class="py-24 bg-black text-white">
  <div class="max-w-4xl mx-auto px-6">
    <div class="text-center mb-12">
      <h2 class="text-4xl md:text-6xl font-black mb-6 tracking-tight">
        Pronto para <span class="text-yellow-400">Economizar R$ 50.000/mês</span> com Nossa Análise?
      </h2>
      
      <p class="text-xl opacity-90 mb-12 max-w-2xl mx-auto">
        Fale com nossos especialistas e descubra como nossa análise pode <span class="text-yellow-400 font-bold">economizar até R$ 50.000 por mês</span> em assinaturas e mensalidades de softwares redundantes.
        <span class="text-red-400 font-bold">Elimine dados desintegrados</span> na jornada do cliente,
        <span class="text-red-400 font-bold">reduza cancelamentos</span> e <span class="text-red-400 font-bold">aumente seu lucro</span>.
      </p>
    </div>
    
    <div class="bg-white/5 backdrop-blur-lg rounded p-8 border border-white/10">
      <form id="contactForm" class="space-y-6">
        <div class="grid md:grid-cols-2 gap-6">
          <div>
            <label for="nome" class="block text-sm font-medium mb-2">Nome Completo *</label>
            <input 
              type="text" 
              id="nome" 
              name="nome" 
              required 
              class="w-full p-4 border border-white/20 rounded-sm bg-white/5 backdrop-blur-lg text-white placeholder-white/60 focus:outline-none focus:border-primary-500 focus:bg-white/10 transition-all duration-300"
              placeholder="Seu nome completo"
            />
          </div>
          
          <div>
            <label for="email" class="block text-sm font-medium mb-2">Email *</label>
            <input 
              type="email" 
              id="email" 
              name="email" 
              required 
              class="w-full p-4 border border-white/20 rounded-sm bg-white/5 backdrop-blur-lg text-white placeholder-white/60 focus:outline-none focus:border-primary-500 focus:bg-white/10 transition-all duration-300"
              placeholder="seu@email.com"
            />
          </div>
        </div>
        
        <div class="grid md:grid-cols-2 gap-6">
          <div>
            <label for="telefone" class="block text-sm font-medium mb-2">Telefone/WhatsApp</label>
            <input 
              type="tel" 
              id="telefone" 
              name="telefone" 
              class="w-full p-4 border border-white/20 rounded-sm bg-white/5 backdrop-blur-lg text-white placeholder-white/60 focus:outline-none focus:border-primary-500 focus:bg-white/10 transition-all duration-300"
              placeholder="(11) 99999-9999"
            />
          </div>
          
          <div>
            <label for="empresa" class="block text-sm font-medium mb-2">Empresa *</label>
            <input 
              type="text" 
              id="empresa" 
              name="empresa" 
              required 
              class="w-full p-4 border border-white/20 rounded-sm bg-white/5 backdrop-blur-lg text-white placeholder-white/60 focus:outline-none focus:border-primary-500 focus:bg-white/10 transition-all duration-300"
              placeholder="Nome da sua empresa"
            />
          </div>
        </div>
        
        <div>
          <label for="cargo" class="block text-sm font-medium mb-2">Cargo *</label>
          <input 
            type="text" 
            id="cargo" 
            name="cargo" 
            required 
            class="w-full p-4 border border-white/20 rounded-sm bg-white/5 backdrop-blur-lg text-white placeholder-white/60 focus:outline-none focus:border-primary-500 focus:bg-white/10 transition-all duration-300"
            placeholder="CEO, CTO, Diretor, etc."
          />
        </div>
        
        <div>
          <label class="block text-sm font-medium mb-3">Quais softwares sua empresa utiliza? *</label>
          <div class="grid grid-cols-2 md:grid-cols-3 gap-3 mb-4">
            <!-- CRM -->
            <label class="flex items-center space-x-2 cursor-pointer p-2 rounded border border-white/20 hover:bg-white/10 transition-all">
              <input type="checkbox" name="softwares" value="Salesforce" class="rounded text-primary-500 focus:ring-primary-500">
              <span class="text-sm">Salesforce</span>
            </label>
            <label class="flex items-center space-x-2 cursor-pointer p-2 rounded border border-white/20 hover:bg-white/10 transition-all">
              <input type="checkbox" name="softwares" value="HubSpot" class="rounded text-primary-500 focus:ring-primary-500">
              <span class="text-sm">HubSpot</span>
            </label>
            <label class="flex items-center space-x-2 cursor-pointer p-2 rounded border border-white/20 hover:bg-white/10 transition-all">
              <input type="checkbox" name="softwares" value="Pipedrive" class="rounded text-primary-500 focus:ring-primary-500">
              <span class="text-sm">Pipedrive</span>
            </label>
            <label class="flex items-center space-x-2 cursor-pointer p-2 rounded border border-white/20 hover:bg-white/10 transition-all">
              <input type="checkbox" name="softwares" value="Zoho CRM" class="rounded text-primary-500 focus:ring-primary-500">
              <span class="text-sm">Zoho CRM</span>
            </label>
            
            <!-- Atendimento -->
            <label class="flex items-center space-x-2 cursor-pointer p-2 rounded border border-white/20 hover:bg-white/10 transition-all">
              <input type="checkbox" name="softwares" value="Zendesk" class="rounded text-primary-500 focus:ring-primary-500">
              <span class="text-sm">Zendesk</span>
            </label>
            <label class="flex items-center space-x-2 cursor-pointer p-2 rounded border border-white/20 hover:bg-white/10 transition-all">
              <input type="checkbox" name="softwares" value="Freshdesk" class="rounded text-primary-500 focus:ring-primary-500">
              <span class="text-sm">Freshdesk</span>
            </label>
            <label class="flex items-center space-x-2 cursor-pointer p-2 rounded border border-white/20 hover:bg-white/10 transition-all">
              <input type="checkbox" name="softwares" value="Intercom" class="rounded text-primary-500 focus:ring-primary-500">
              <span class="text-sm">Intercom</span>
            </label>
            
            <!-- Comunicação -->
            <label class="flex items-center space-x-2 cursor-pointer p-2 rounded border border-white/20 hover:bg-white/10 transition-all">
              <input type="checkbox" name="softwares" value="Slack" class="rounded text-primary-500 focus:ring-primary-500">
              <span class="text-sm">Slack</span>
            </label>
            <label class="flex items-center space-x-2 cursor-pointer p-2 rounded border border-white/20 hover:bg-white/10 transition-all">
              <input type="checkbox" name="softwares" value="Microsoft Teams" class="rounded text-primary-500 focus:ring-primary-500">
              <span class="text-sm">Microsoft Teams</span>
            </label>
            <label class="flex items-center space-x-2 cursor-pointer p-2 rounded border border-white/20 hover:bg-white/10 transition-all">
              <input type="checkbox" name="softwares" value="Discord" class="rounded text-primary-500 focus:ring-primary-500">
              <span class="text-sm">Discord</span>
            </label>
            
            <!-- ERP -->
            <label class="flex items-center space-x-2 cursor-pointer p-2 rounded border border-white/20 hover:bg-white/10 transition-all">
              <input type="checkbox" name="softwares" value="SAP" class="rounded text-primary-500 focus:ring-primary-500">
              <span class="text-sm">SAP</span>
            </label>
            <label class="flex items-center space-x-2 cursor-pointer p-2 rounded border border-white/20 hover:bg-white/10 transition-all">
              <input type="checkbox" name="softwares" value="Oracle" class="rounded text-primary-500 focus:ring-primary-500">
              <span class="text-sm">Oracle</span>
            </label>
            <label class="flex items-center space-x-2 cursor-pointer p-2 rounded border border-white/20 hover:bg-white/10 transition-all">
              <input type="checkbox" name="softwares" value="NetSuite" class="rounded text-primary-500 focus:ring-primary-500">
              <span class="text-sm">NetSuite</span>
            </label>
            
            <!-- Outros -->
            <label class="flex items-center space-x-2 cursor-pointer p-2 rounded border border-white/20 hover:bg-white/10 transition-all">
              <input type="checkbox" name="softwares" value="ClickUp" class="rounded text-primary-500 focus:ring-primary-500">
              <span class="text-sm">ClickUp</span>
            </label>
            <label class="flex items-center space-x-2 cursor-pointer p-2 rounded border border-white/20 hover:bg-white/10 transition-all">
              <input type="checkbox" name="softwares" value="Asana" class="rounded text-primary-500 focus:ring-primary-500">
              <span class="text-sm">Asana</span>
            </label>
            <label class="flex items-center space-x-2 cursor-pointer p-2 rounded border border-white/20 hover:bg-white/10 transition-all">
              <input type="checkbox" name="softwares" value="Trello" class="rounded text-primary-500 focus:ring-primary-500">
              <span class="text-sm">Trello</span>
            </label>
          </div>
          
          <!-- Campo para outros softwares -->
          <div>
            <label for="outros_softwares" class="block text-sm font-medium mb-2">Outros softwares (se não estiver na lista acima)</label>
            <input 
              type="text" 
              id="outros_softwares" 
              name="outros_softwares" 
              class="w-full p-4 border border-white/20 rounded-sm bg-white/5 backdrop-blur-lg text-white placeholder-white/60 focus:outline-none focus:border-primary-500 focus:bg-white/10 transition-all duration-300"
              placeholder="Ex: Monday.com, Notion, Jira, etc."
            />
          </div>
        </div>
        
        <div>
          <label for="mensagem" class="block text-sm font-medium mb-2">Como podemos ajudar? (Opcional)</label>
          <textarea 
            id="mensagem" 
            name="mensagem" 
            rows="3"
            class="w-full p-4 border border-white/20 rounded-sm bg-white/5 backdrop-blur-lg text-white placeholder-white/60 focus:outline-none focus:border-primary-500 focus:bg-white/10 transition-all duration-300 resize-none"
            placeholder="Conte-nos sobre os principais desafios da sua empresa com softwares para nossa análise..."
          ></textarea>
        </div>
        
        <button 
          type="submit" 
          class="w-full bg-primary-500 text-white p-5 border-none rounded-sm font-bold text-lg cursor-pointer transition-all duration-300 shadow-lg hover:-translate-y-1 hover:shadow-xl hover:bg-primary-600"
        >
          🚀 RECEBA PRÉ-ANÁLISE KaaS GRATUITA
        </button>
        
        <p class="text-sm text-white/60 text-center">
          * Campos obrigatórios. Entraremos em contato em até 24h.
        </p>
      </form>
    </div>
  </div>
</section>

<script>
  // Função para mostrar mensagem de sucesso personalizada
  function mostrarMensagemSucesso() {
    // Criar container do toast
    const toast = document.createElement('div');
    toast.className = 'fixed top-4 right-4 bg-gradient-to-r from-green-500 to-green-600 text-white p-6 rounded shadow-2xl z-50 max-w-sm transform translate-x-full transition-all duration-500';
    toast.innerHTML = `
      <div class="flex items-start gap-3">
        <div class="flex-shrink-0">
          <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center">
            <span class="text-xl">🎉</span>
          </div>
        </div>
        <div class="flex-1">
          <h3 class="font-bold text-lg mb-1">Obrigado pelo seu interesse!</h3>
          <p class="text-sm opacity-90 leading-relaxed">
            Recebemos sua solicitação de análise gratuita. Nossa equipe entrará em contato em até 24h para agendar sua consultoria especializada.
          </p>
        </div>
        <button onclick="this.parentElement.parentElement.remove()" class="text-white/70 hover:text-white text-xl leading-none">&times;</button>
      </div>
    `;
    
    document.body.appendChild(toast);
    
    // Animar entrada
    setTimeout(() => {
      toast.classList.remove('translate-x-full');
      toast.classList.add('translate-x-0');
    }, 100);
    
    // Auto-remover após 8 segundos
    setTimeout(() => {
      toast.classList.remove('translate-x-0');
      toast.classList.add('translate-x-full');
      setTimeout(() => {
        if (toast.parentElement) {
          toast.remove();
        }
      }, 500);
    }, 8000);
  }

  // Formulário principal
  document.getElementById('contactForm')?.addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const form = this as HTMLFormElement;
    const formData = new FormData(form);
    // Capturar softwares selecionados
    const softwaresSelecionados = Array.from(form.querySelectorAll('input[name="softwares"]:checked')).map(input => input.value);
    const outrosSoftwares = formData.get('outros_softwares') || '';
    
    // Validar se pelo menos um software foi selecionado
    if (softwaresSelecionados.length === 0 && !outrosSoftwares.trim()) {
      alert('❌ Por favor, selecione pelo menos um software que sua empresa utiliza.');
      return;
    }
    
    const data = {
      nome: formData.get('nome'),
      email: formData.get('email'),
      telefone: formData.get('telefone'),
      empresa: formData.get('empresa'),
      cargo: formData.get('cargo'),
      mensagem: formData.get('mensagem') || '',
      softwares: softwaresSelecionados,
      outros_softwares: outrosSoftwares,
      timestamp: new Date().toISOString(),
      source: 'klonatec-website'
    };
    
    // Mostrar loading no botão
    const submitBtn = this.querySelector('button[type="submit"]') as HTMLButtonElement;
    const originalText = submitBtn.innerHTML;
    submitBtn.innerHTML = '⏳ Salvando...';
    submitBtn.disabled = true;
    
    try {
      // Configuração do Supabase
      const SUPABASE_URL = 'https://rvbqybwpgplgnwgrqcxy.supabase.co';
      const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ2YnF5YndwZ3BsZ253Z3JxY3h5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4OTA4MDgsImV4cCI6MjA3MTQ2NjgwOH0.W_XCEBNnC6MqxN9vVTQJr8w7XrRKnBAIje-gxkW2s4A';
      
      // Enviar para Supabase
      const response = await fetch(`${SUPABASE_URL}/rest/v1/leads`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
          'apikey': SUPABASE_ANON_KEY,
          'Prefer': 'return=minimal'
        },
        body: JSON.stringify({
          nome: data.nome,
          email: data.email,
          telefone: data.telefone,
          empresa: data.empresa,
          cargo: data.cargo,
          mensagem: data.mensagem,
          softwares: data.softwares,
          outros_softwares: data.outros_softwares,
          source: data.source,
          timestamp_original: data.timestamp,
          data_processamento: new Date().toISOString(),
          tipo_lead: 'lead_basico',
          prioridade: 'media',
          segmento: 'nao_identificado',
          lead_score: 10,
          status: 'novo_lead',
          proximo_passo: 'Entraremos em contato em até 24h para uma análise gratuita.',
          valor_estimado: 50000,
          probabilidade: 25,
          data_fechamento: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]
        })
      });
      
      console.log('Response status:', response.status);
      console.log('Response headers:', response.headers);
      
      if (response.ok) {
        // Tentar ler a resposta como JSON, mas se falhar, assumir sucesso
        try {
          const result = await response.json();
          console.log('Lead salvo com sucesso:', result);
        } catch (jsonError) {
          console.log('Resposta não é JSON, mas operação foi bem-sucedida');
        }
        
            // Mostrar mensagem personalizada de sucesso
            mostrarMensagemSucesso();
            form.reset();
      } else {
        // Tentar ler erro como texto primeiro
        let errorMessage = `Status: ${response.status}`;
        try {
          const errorText = await response.text();
          console.error('Erro na resposta:', response.status, errorText);
          errorMessage += ` - ${errorText}`;
        } catch (textError) {
          console.error('Erro ao ler resposta como texto:', textError);
        }
        alert('❌ Erro ao salvar no banco: ' + errorMessage);
      }
        } catch (error) {
          console.error('Erro de conexão:', error);
          alert('❌ Erro de conexão: ' + (error as Error).message);
    } finally {
      // Restaurar botão
      submitBtn.innerHTML = originalText;
      submitBtn.disabled = false;
    }
  });
</script>
